# ComfyUI MechaBaby 节点搜索

> **语言选择**: [English](README.md) | [中文](README_zh.md) | [日本語](README_ja.md) | [한국어](README_ko.md) | [Русский](README_ru.md)

增强ComfyUI节点搜索和导航功能的扩展，支持Ctrl+F快捷键。

## 功能特性

- 🔍 **节点搜索定位**：快速搜索节点名称并跳转
- 📝 **属性搜索**：搜索节点属性名称和属性值（包括数字和文本）
- 🔗 **端口传送**：在节点端口上右键，直接跳转到连接的节点
- ⚡ **快速跳转菜单**：选中节点后按快捷键（默认F1），快速查看并跳转到所有连接的节点
- 🔍 **搜索框增强**：节点搜索对话框（Ctrl+F）现在支持拖拽移动和钉住固定
- 📌 **钉住窗口**：将快速跳转菜单或搜索对话框固定在指定位置，方便持续使用
- 👁️ **自动显示**：窗口钉住后，可开启自动显示，点击节点时自动显示跳转列表
- ⏪ **历史导航**：使用鼠标侧键或可自定义的键盘按键进行跳转历史导航
- 🔄 **自动跳转**：当端口只有一个连接时自动跳转（可选）
- ⌨️ **快捷键支持**：`Ctrl+F` 快速打开搜索对话框
- 🎯 **智能匹配**：支持节点标题、类型、节点ID、控件名称、控件值、属性名称、属性值的搜索
- ✨ **金黄色闪烁高亮**：跳转后目标节点会金黄色闪烁，更容易看到
- 🔄 **Easy Use 支持**：支持 `easy getNode` 和 `easy setNode` 节点之间的跳转（comfyui-easy-use 扩展）
- ⚙️ **丰富的配置选项**：自动跳转、菜单阻止、导航按键、菜单缩放等全面设置

## 安装

1. 将本扩展目录 `ComfyUI-MechaBabyNodeSearch` 放入 `ComfyUI/custom_nodes/` 目录
2. 重启 ComfyUI
3. 扩展会自动加载

## 使用方法

### 节点搜索

1. **快捷键方式**：按 `Ctrl+F` 打开搜索对话框
2. **右键菜单方式**：在画布空白处右键，选择 "🔍 搜索节点 (Ctrl+F)"

在搜索框中输入关键词，可以搜索：
- 节点标题
- 节点类型
- 节点ID
- 控件名称（如 "steps", "cfg", "seed" 等）
- 控件值（如 "20", "7.5", "prompt text" 等）
- 属性名称
- 属性值

### 扩展设置

进入扩展设置的方法：
1. **右键菜单方式**：在画布空白处右键，选择 "⚙️ 节点搜索设置"
2. 在设置菜单中，您可以：
   - 更改界面语言（中文、英文、日文、韩文、俄文）
   - 自定义快捷键（默认：Ctrl+F）

**搜索技巧**：
- 使用上下箭头键在结果列表中导航
- 按 `Enter` 跳转到选中的节点
- 按 `Esc` 关闭搜索对话框

### 端口传送

1. **方式一**：在节点上右键，选择 "🔗 传送到连接节点"，然后选择要跳转的连接
2. **方式二**：直接在端口上右键（如果端口有连接），会自动跳转或显示连接列表
3. **方式三**：选中节点后按快速跳转快捷键（默认F1），打开快速跳转菜单查看所有连接的节点

### 端口传送设置

进入端口传送设置的方法：
1. **右键菜单方式**：在画布空白处右键，选择 "⚙️ 节点搜索设置" → "🎯 端口传送设置"
2. 在设置菜单中，您可以配置：
   - **自动跳转**：开启/关闭端口只有一个连接时的自动跳转
   - **完全阻止菜单显示**：开启/关闭自动跳转时完全阻止菜单显示
   - **历史导航**：开启/关闭鼠标侧键和键盘历史导航
   - **自定义导航按键**：设置后退/前进导航的自定义按键
   - **快速跳转快捷键**：设置快速跳转菜单的自定义快捷键（默认：F1）
   - **菜单缩放**：调整快速跳转菜单的缩放比例（50%、75%、100%、125%、150%，或根据画布缩放自动调整）

### 钉住窗口和自动显示

1. **钉住窗口**：点击快速跳转菜单或搜索对话框标题栏中的 📍 按钮，将窗口固定在指定位置
   - 钉住后，跳转到任何节点时窗口都不会消失
   - 切换节点或发起新搜索时窗口位置保持不变
   - 点击 📌 按钮可取消钉住

2. **可移动对话框**：快速跳转菜单和搜索对话框均可通过标题栏拖拽移动位置。处于钉住状态时会记住位置。

2. **自动显示**：窗口钉住后，点击 👁️ 按钮可开启自动显示功能
   - 开启后，点击任何节点都会自动显示跳转列表
   - 再次点击可关闭，恢复为按快捷键才显示的模式
   - 自动显示按钮仅在窗口钉住时显示

## 功能演示

### 搜索节点
- 输入 "ksampler" 可以找到所有 KSampler 节点
- 输入 "512" 可以找到所有包含 512 这个值的节点（如宽度、高度等）
- 输入 "steps" 可以找到所有有 steps 控件的节点

### 端口传送
- 在 KSampler 节点的 "model" 输入端口右键，可以跳转到连接的 CheckpointLoaderSimple 节点
- 在 CheckpointLoaderSimple 节点的输出端口右键，可以跳转到所有使用该模型的节点

## 技术实现

- **扩展类型**：Web Extension (JavaScript)
- **依赖**：ComfyUI 核心 API
- **兼容性**：ComfyUI 1.0+

## 许可证

MIT License

## 更新日志

### v1.6.0 (2026-01-25)
- 节点搜索对话框（Ctrl+F）新增可移动及钉住功能
- 优化搜索框体验：钉住后可记住位置，且在跳转节点后保持开启
- 增强 Toast 提示：采用蓝色半透明高级感样式，90% 透明度，优化字体显示
- 提升 UI 一致性：所有弹窗现在均支持标题栏拖拽移动
- 修复快速跳转（F1）逻辑：修正了 GET/SET 节点的箭头指向及 Easy Use 节点分类显示

### v1.5.0 (2026-01-08)
- 新增钉住窗口功能：将快速跳转菜单固定在指定位置
- 新增自动显示功能：窗口钉住后，可开启自动显示，点击节点时自动显示跳转列表
- 改进用户体验：将阻塞式的alert弹窗替换为非阻塞的toast提示
- 修复GET/SET节点在快速跳转菜单和右键菜单中的箭头方向
- 修复Easy Use节点显示：GET节点在左侧面板显示SET节点，SET节点在右侧面板显示GET节点
- 修复"无连接"显示：当存在Easy Use节点时不再显示"无连接"
- 增强toast提示：增大字体并提升可见性

### v1.4.0 (2026-01-08)
- 新增自动跳转功能：当端口只有一个连接时，右键直接跳转而不显示菜单
- 新增完全阻止菜单显示选项：自动跳转时可完全阻止菜单显示（包括其他扩展的菜单）
- 新增跳转历史导航功能：
  - 鼠标侧键导航（后退=侧键1，前进=侧键2）
  - 键盘导航（可自定义按键，默认：后退=F2，前进=F3）
- 新增快速跳转功能：
  - 快速跳转快捷键（默认F1，可自定义，支持组合键如Ctrl+F1）
  - 快速跳转菜单，以双栏布局显示所有连接的节点（输入/输出）
  - 可拖拽的快速跳转菜单
  - 菜单缩放调整（50%、75%、100%、125%、150%，或根据画布缩放自动调整）
- 增强端口传送设置菜单，提供全面的配置选项

### v1.3.2 (2026-01-07)
- 新增自定义快捷键功能
- 新增多语言支持（中文、英文、日文、韩文、俄文）
- 首次加载时自动检测浏览器语言
- 新增设置对话框（快捷键和语言配置）
- 端口传送菜单项支持多语言
- 新增节点ID搜索功能
- 更新输入框占位符，提及节点ID搜索
- 增强搜索功能，支持节点ID匹配
- 优化结果导航：搜索结果列表会自动滚动，始终保持当前选中项可见

### v1.2.0 (2026-01-07)
- 新增节点跳转后金黄色闪烁高亮效果
- 新增 `easy getNode` 和 `easy setNode` 节点跳转支持（comfyui-easy-use 扩展）
- 迁移到新的 ComfyUI Context Menu API
- 打开搜索框时自动聚焦到输入框
- 代码优化和 bug 修复

### v1.0.0 (2026-01-06)
- 初始版本
- 实现节点搜索功能
- 实现属性搜索功能
- 实现端口传送功能
- 添加快捷键支持

## 贡献

欢迎提交 Issue 和 Pull Request！

## 作者

MechaBaby

